<div class="order-list-container">
  <div class="header">
    <h2><i class="fa-solid fa-receipt"></i> Lista de Pedidos</h2>
  </div>

  <div class="filter-container" [formGroup]="filtroForm">
    <div class="filter-group">
        <label for="dataDe">De</label>
        <input id="dataDe" type="date" formControlName="dataVendaDe">
    </div>
    <div class="filter-group">
        <label for="dataAte">Até</label>
        <input id="dataAte" type="date" formControlName="dataVendaAte">
    </div>
     <div class="filter-group">
        <label for="valorMin">Valor Mínimo</label>
        <input id="valorMin" type="number" formControlName="valorTotalMinimo" placeholder="R$ 0,00">
    </div>
    <div class="filter-group">
        <label for="valorMax">Valor Máximo</label>
        <input id="valorMax" type="number" formControlName="valorTotalMaximo" placeholder="R$ 1.000,00">
    </div>
    <div class=" action-group">
        <button (click)="limparFiltros()" class="clear-button">
          <i class="fa-solid fa-eraser"></i> Limpar
        </button>
    </div>
  </div>

  <div class="table-wrapper">
    <table *ngIf="!isLoading && vendasDaPagina.length > 0; else noResults">
      <thead>
        <tr>
          <th>ID do Pedido</th>
          <th>Cliente</th>
          <th>Data</th>
          <th>Status</th>
          <th>Valor Total</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let venda of vendasDaPagina">
          <td>#{{ venda.id }}</td>
          <td>{{ venda.nomeUsuario }}</td>
          <td>{{ venda.dataVenda | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <span class="status" [ngClass]="getStatusNome(venda.status).toLowerCase()">
              {{ getStatusNome(venda.status) }}
            </span>
          </td>
          <td>{{ venda.valorTotal | currency: 'BRL' }}</td>
          <td class="actions-cell">
            <button (click)="verDetalhes(venda.id)" class="action-button view-button" title="Ver Detalhes">
              <i class="fa fa-eye"></i>
            </button>
            <button *ngIf="venda.status === StatusVendaEnum.Pendente" (click)="atualizarStatus(venda.id, StatusVendaEnum.Confirmada)" class="action-button confirm-button" title="Confirmar">
              <i class="fa fa-check"></i>
            </button>
            <button 
              *ngIf="venda.status === StatusVendaEnum.Confirmada" 
              (click)="animarCaminhao(venda)" 
              [class.animar]="isAnimando(venda)" 
              class="action-button ship-button" 
              title="Enviar">
              <i class="fa fa-truck"></i>
            </button>
            <button *ngIf="venda.status === StatusVendaEnum.Enviada" (click)="atualizarStatus(venda.id, StatusVendaEnum.Entregue)" class="action-button deliver-button" title="Entregue">
              <i class="fa fa-box-open"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    
    <ng-template #noResults>
      <div class="state-container">
        <p *ngIf="isLoading" class="loading-state">A carregar pedidos...</p>
        <p *ngIf="!isLoading && vendasDaPagina.length === 0" class="empty-state">Nenhum pedido encontrado.</p>
      </div>
    </ng-template>
  </div>
  
  <div class="pagination-container" *ngIf="totalCount > pageSize">
      <button (click)="mudarPagina(currentPage - 1)" [disabled]="currentPage === 1">Anterior</button>
      <span>Página {{ currentPage }} de {{ totalPages }}</span>
      <button (click)="mudarPagina(currentPage + 1)" [disabled]="currentPage === totalPages">Próxima</button>
  </div>
</div>
